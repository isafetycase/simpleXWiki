var XWiki=(function(l){var s=0;l.EntityType={WIKI:s++,SPACE:s++,DOCUMENT:s++,ATTACHMENT:s++,OBJECT:s++,OBJECT_PROPERTY:s++,CLASS_PROPERTY:s++};var d=[];for(var q in l.EntityType){if(l.EntityType.hasOwnProperty(q)){var f=l.EntityType[q];var p=q.toLowerCase().split("_");for(var u=1;u<p.length;u++){p[u]=p[u].substr(0,1).toUpperCase()+p[u].substr(1)}d[f]=p.join("")}}l.EntityType.getName=function(i){return d[i]};l.EntityType.byName=function(A){for(var i=0;i<d.length;i++){if(d[i]===A){return i}}return -1};l.EntityReference=Class.create({initialize:function(i,B,A){this.name=i;this.type=B;this.parent=A},extractReference:function(A){var i=this;while(i&&i.type!=A){i=i.parent}return i},extractReferenceValue:function(A){var i=this.extractReference(A);return i?i.name:null},relativeTo:function(C){var B=this._extractComponents().reverse();var D=C?C._extractComponents().reverse():[];while(B.length>0&&D.length>0&&B[0].type!=D[0].type){B[0].type>D[0].type?D.shift():B.shift()}while(B.length>0&&D.length>0&&B[0].type==D[0].type&&B[0].name==D[0].name){B.shift();D.shift()}if(B.length==0){return new l.EntityReference("",this.type)}else{B=B.reverse();for(var A=0;A<B.length;A++){B[A]=new l.EntityReference(B[A].name,B[A].type);if(A>0){B[A-1].parent=B[A]}}return B[0]}},_extractComponents:function(){var A=[];var i=this;while(i){A.push(i);i=i.parent}return A}});l.WikiReference=Class.create(l.EntityReference,{initialize:function($super,i){$super(i,l.EntityType.WIKI)}});l.SpaceReference=Class.create(l.EntityReference,{initialize:function($super,A,i){$super(i,l.EntityType.SPACE,new l.WikiReference(A))}});l.DocumentReference=Class.create(l.EntityReference,{initialize:function($super,B,A,i){$super(i,l.EntityType.DOCUMENT,new l.SpaceReference(B,A))}});l.AttachmentReference=Class.create(l.EntityReference,{initialize:function($super,A,i){$super(A,l.EntityType.ATTACHMENT,i)}});var r="\\";var k=r+r;var m=":";var x=".";var h="@";var b="^";var y=x;var o=b;var n=[[],[x,m,r],[x,r],[h,r],[b,r],[y,r],[o,x,r]];var t=[[],[r+x,r+m,k],[r+x,k],[r+h,k],[r+b,k],[r+y,k],[r+o,r+x,k]];var v=[[],[m],[x,m],[h,x,m],[b,x,m],[y,b,x,m],[o,x,m]];var c=[[l.EntityType.WIKI],[l.EntityType.SPACE,l.EntityType.WIKI],[l.EntityType.DOCUMENT,l.EntityType.SPACE,l.EntityType.WIKI],[l.EntityType.ATTACHMENT,l.EntityType.DOCUMENT,l.EntityType.SPACE,l.EntityType.WIKI],[l.EntityType.OBJECT,l.EntityType.DOCUMENT,l.EntityType.SPACE,l.EntityType.WIKI],[l.EntityType.OBJECT_PROPERTY,l.EntityType.OBJECT,l.EntityType.DOCUMENT,l.EntityType.SPACE,l.EntityType.WIKI],[l.EntityType.CLASS_PROPERTY,l.EntityType.DOCUMENT,l.EntityType.SPACE,l.EntityType.WIKI]];var z=[k,r];var e=[r,""];function j(E,A,B){for(var D=0;D<B.length;D++){var C=A+D;if(C>=E.length||E.charAt(C)!=B.charAt(D)){return false}}return true}function a(F,E,D){var A="",C=-1;while(++C<F.length){for(var B=0;B<E.length;B++){if(j(F,C,E[B])){F=F.substr(0,C)+D[B]+F.substr(C+E[B].length);C+=D[B].length-1;break}}}return F}l.EntityReferenceResolver=Class.create({resolve:function(C,F){C=C||"";F=parseInt(F);if(isNaN(F)||F<0||F>=v.length){throw"No parsing definition found for Entity Type ["+F+"]"}var D;var B=v[F];var H=c[F];for(var G=0;G<B.length&&C!=null;G++){var E=this._splitAndUnescape(C,B[G]);C=E[0];var I=new l.EntityReference(E[1],H[G]);D=this._appendParent(D,I)}if(C!=null){var A=a(C,z,e);var I=new l.EntityReference(A,H[B.length]);D=this._appendParent(D,I)}return D},_appendParent:function(i,B){if(i){var A=i;while(A.parent){A=A.parent}A.parent=B;return i}else{return B}},_splitAndUnescape:function(D,G){var C=[];var E=D.length;while(--E>=0){var B=D.charAt(E);var A=E-1;var H=0;if(A>=0){H=D.charAt(A)}if(B==G){var F=this._getNumberOfCharsBefore(r,D,A);if(F%2==0){break}else{--E}}else{if(H==r){--E}}C.push(B)}return[E<0?null:D.substring(0,E),C.reverse().join("")]},_getNumberOfCharsBefore:function(C,A,B){var i=B;while(i>=0&&A.charAt(i)==C){--i}return B-i}});l.EntityReferenceSerializer=Class.create({serialize:function(i){return i?this.serialize(i.parent)+this._serializeComponent(i):""},_serializeComponent:function(B){var i="";var A=n[B.type];if(B.parent){i+=B.parent.type==l.EntityType.WIKI?m:A[0]}if(A.length>0){i+=a(B.name,A,t[B.type])}else{i+=B.name.replace(r,k)}return i}});var g=new l.EntityReferenceResolver();var w=new l.EntityReferenceSerializer();l.Model={serialize:function(i){return w.serialize(i)},resolve:function(i,A){return g.resolve(i,A)}};return l}(XWiki||{}));